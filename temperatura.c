#include <stdio.h>#include <stdlib.h>#include <unistd.h>#include <gpiod.h>#include <time.h>#include <stdint.h>#define CHIP_NAME "/dev/gpiochip0"#define DHT_PIN 26 // Cambiar al pin correcto para el sensor DHT#define TEMP_30 20  // Temperatura mayor a 30°C#define TEMP_40 30  // Temperatura mayor a 40°C#define TEMP_50 40  // Temperatura mayor a 50°C// Función para leer el sensor DHT11int leer_dht11(struct gpiod_line *dht_line, int *temperatura, int *humedad) {    uint8_t data[5] = {0}; // Buffer de datos del sensor    struct timespec start, end;    // Enviar señal de inicio al sensor (bajar el pin por 18ms)    gpiod_line_request_output(dht_line, "dht_output", 0);    gpiod_line_set_value(dht_line, 0);    usleep(18000); // 18ms    gpiod_line_set_value(dht_line, 1);    usleep(40); // Esperar 40us    gpiod_line_request_input(dht_line, "dht_input");    // Leer respuesta del sensor    clock_gettime(CLOCK_MONOTONIC, &start);    while (gpiod_line_get_value(dht_line) == 1) {        clock_gettime(CLOCK_MONOTONIC, &end);        if ((end.tv_nsec - start.tv_nsec) > 100000) { // Tiempo máximo de espera            return -1; // Error: sin respuesta        }    }    // Leer 40 bits de datos    for (int i = 0; i < 40; i++) {        // Esperar el inicio del bit        while (gpiod_line_get_value(dht_line) == 0);        clock_gettime(CLOCK_MONOTONIC, &start);        // Medir duración del pulso alto        while (gpiod_line_get_value(dht_line) == 1);        clock_gettime(CLOCK_MONOTONIC, &end);        if ((end.tv_nsec - start.tv_nsec) > 50000) { // Pulso largo = 1            data[i / 8] |= (1 << (7 - (i % 8)));        }    }    // Validar checksum    if (data[4] != (data[0] + data[1] + data[2] + data[3])) {        return -1; // Error: checksum inválido    }    // Extraer temperatura y humedad    *humedad = data[0];    *temperatura = data[2];    return 0;}int main() {    struct gpiod_chip *chip;    struct gpiod_line *dht_line;    int temperatura, humedad;    // Abrir el chip GPIO    chip = gpiod_chip_open(CHIP_NAME);    if (!chip) {        perror("No se pudo abrir el chip GPIO");        return 1;    }    // Configurar el pin del sensor    dht_line = gpiod_chip_get_line(chip, DHT_PIN);    if (!dht_line) {        perror("No se pudo obtener la línea GPIO del sensor");        gpiod_chip_close(chip);        return 1;    }    printf("Listo para comenzar...\n");    while (1) {        if (leer_dht11(dht_line, &temperatura, &humedad) == 0) {            printf("Temperatura: %d°C, Humedad: %d%%\n", temperatura, humedad);            if (temperatura > TEMP_50) {                printf("Estado: Crítico 3 - Activando on27.sh\n");                system("sh /home/grupo2/on27.sh");                system("sh /home/grupo2/off21.sh");                system("sh /home/grupo2/off17.sh");            } else if (temperatura > TEMP_40) {                printf("Estado: Crítico 2 - Activando on21.sh\n");                system("sh /home/grupo2/on21.sh");                system("sh /home/grupo2/off17.sh");                system("sh /home/grupo2/off27.sh");            } else if (temperatura > TEMP_30) {                printf("Estado: Crítico 1 - Activando on17.sh\n");                system("sh /home/grupo2/on17.sh");                system("sh /home/grupo2/off21.sh");                system("sh /home/grupo2/off27.sh");            } else {                printf("Estado: Normal - Apagando todos los scripts\n");                system("sh /home/grupo2/off17.sh");                system("sh /home/grupo2/off21.sh");                system("sh /home/grupo2/off27.sh");            }        } else {            printf("Error al leer el sensor DHT11\n");        }        sleep(2); // Esperar 2 segundos antes de la próxima lectura    }    gpiod_chip_close(chip);    return 0;}